<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>æ•™è‚²æ•°æ®å¯è§†åŒ–</title>
  <script src="{{ url_for('static', filename='js/echarts.min.js') }}"></script>
  <script src="{{ url_for('static', filename='js/echarts-wordcloud.js') }}"></script>
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/vis-network@9.1.0/dist/vis-network.min.js"></script>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      display: flex;
      height: 100vh;
      background-color: #f6fbfe;
    }

    .sidebar {
      position: fixed;
      width: 220px;
      background-color: #111827;
      color: white;
      padding: 20px;
      box-sizing: border-box;
      height: 100vh;
      z-index: 100;
    }

    .sidebar h2 {
      font-size: 18px;
      margin-bottom: 40px;
    }

    .sidebar ul {
      list-style: none;
      padding: 0;
    }

    .sidebar li {
      margin: 20px 0;
      cursor: pointer;
      padding: 10px;
      border-radius: 6px;
      transition: background 0.3s;
    }

    .sidebar li:hover,
    .sidebar li.active {
      background-color: #374151;
    }

    .content {
      flex-grow: 1;
      background-color: #f3f4f6;
      box-sizing: border-box;
      padding: 20px 60px;
      overflow-y: auto;
      min-height: calc(100vh - 40px);
      margin-left: 220px;
      padding-top: 70px;
    }

    .page {
      display: none;
    }

    .page.active {
      display: block;
      animation: fadeIn 0.5s;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .chart-container {
      width: 100%;
      height: calc(100vh - 120px);
      margin-bottom: 30px;
      display: flex;
      background-color: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      overflow: hidden;
    }

    .chart {
      flex: 0 0 60%;
      height: 100%;
    }

    .chart-description {
      flex: 0 0 40%;
      padding: 20px;
      background-color: #f8f9fa;
      overflow-y: auto;
    }

    .stat-card {
      flex: 1;
      min-width: 200px;
      color: white;
      padding: 20px;
      border-radius: 12px;
      margin: 10px;
    }

    @media (max-width: 768px) {
      .content {
        padding: 20px;
        margin-left: 0;
      }

      .sidebar {
        transform: translateX(-100%);
        transition: transform 0.3s ease;
      }

      .sidebar.active {
        transform: translateX(0);
      }

      .chart-container {
        flex-direction: column;
        height: auto;
      }

      .chart, .chart-description {
        flex: 1 1 100%;
        width: 100%;
      }
    }

  /*    1111111111      */
    /* é¡¶éƒ¨æ  */
    .topbar {
      display: flex;
      justify-content: flex-end;
      align-items: center;
      background-color: #111827;
      color: white;
      padding: 10px 20px;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 100;
    }

    .topbar .user-info {
      display: flex;
      align-items: center;
      cursor: pointer;
      margin-right: 20px;
    }

    .topbar .user-info img {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      margin-right: 10px;
    }

    .topbar .user-name {
      font-size: 16px;
    }

    .topbar .logout-btn {
      background-color: #f59e0b;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      cursor: pointer;
    }

    .topbar .logout-btn:hover {
      background-color: #ec4899;
    }
    .search-type {
      margin: 15px 0;
    }
    .search-type button {
      padding: 8px 15px;
      margin-right: 10px;
      background: #eee;
      border: 1px solid #ddd;
      cursor: pointer;
    }
    .search-type button.active {
      background: #4CAF50;
      color: white;
      border-color: #45a049;
    }
    .search-section {
      margin-bottom: 20px;
    }
    input[type="text"] {
      padding: 8px;
      width: 300px;
      margin-right: 10px;
    }
    button {
      padding: 8px 15px;
      background: #4CAF50;
      color: white;
      border: none;
      cursor: pointer;
    }
    button:hover {
      background: #45a049;
    }



  </style>
</head>

<body>
<!--é¡¶éƒ¨æ -->
<div class="topbar">
  <div class="user-info" onclick="toggleUserInfo()">
    <img src="{{ url_for('static', filename='img/admin.png') }}" alt="User Avatar" />
    <div class="user-name" id="username">ç”¨æˆ·å</div>
  </div>
  <button class="logout-btn" onclick="logout()">ç™»å‡º</button>
  <script>
    function logout() {
      fetch('/api/logout', {
        method: 'POST',  // ä½¿ç”¨ POST è¯·æ±‚
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({})  // ç©ºçš„è¯·æ±‚ä½“
      })
              .then(response => response.json())
              .then(data => {
                if (data.success) {
                  // ç›´æ¥è·³è½¬åˆ°ç™»å½•é¡µé¢
                  window.location.replace("http://localhost:5000/logout");
                  window.location.reload();  // åˆ·æ–°é¡µé¢
                  window.location.reload();  // åˆ·æ–°é¡µé¢
                } else {
                  alert('ç™»å‡ºå¤±è´¥');
                }
              })
              .catch(error => {
                console.error('ç™»å‡ºè¯·æ±‚é”™è¯¯:', error);
              });
    }
  </script>
</div>




<!--ä¾§è¾¹æ -->
<div class="sidebar">
  <h2>æ•™è‚²å›¾è°±å¯è§†åŒ–</h2>
  <ul>
    <li class="nav-item" data-page="home">ğŸ  é¦–é¡µ</li>
    <li class="nav-item" data-page="chart">ğŸ“Š å¯è§†å›¾è¡¨</li>
    <li class="nav-item" data-page="data">ğŸ—ƒ æ•°æ®ç®¡ç†</li>
    <li class="nav-item" data-page="query">ğŸ“ˆ å›¾æ•°æ®æŸ¥è¯¢</li>
    <li class="nav-item" data-page="analyze">ğŸ§  å›¾æ•°æ®åˆ†æ</li>
  </ul>

</div>

<!-- é¦–é¡µå†…å®¹ -->
<div class="content" style="background-color:#f6fbfe">
  <div id="home" class="page active">
    <h1 style="font-size: 50px">æ•™è‚²æ•°æ®çŸ¥è¯†å›¾è°±å¯è§†åŒ–åˆ†æç³»ç»Ÿ</h1>
    <p style="color: #555; margin-bottom: 30px;">
      æœ¬ç³»ç»Ÿè‡´åŠ›äºæ„å»ºä¸€ä¸ªå®Œæ•´çš„æ•™è‚²çŸ¥è¯†å›¾è°±ï¼Œå®ç°å­¦ç”Ÿã€æ•™å¸ˆã€è¯¾ç¨‹ã€çŸ¥è¯†ç‚¹ç­‰å¤šç»´åº¦æ•°æ®çš„å¯è§†åŒ–ç®¡ç†ä¸æ™ºèƒ½åˆ†æã€‚
    </p>

    <!-- ç»Ÿè®¡å¡ç‰‡ -->
    <div style="display: flex; flex-wrap: wrap; margin-bottom: 40px;">
      <div class="stat-card" style="background: #3b82f6;">
        ğŸ‘©â€ğŸ“ ç”¨æˆ·æ•°é‡<br><strong style="font-size: 24px;" id="user-count">820+</strong>
      </div>
      <div class="stat-card" style="background: #10b981;">
        ğŸ‘¨â€ğŸ« æ•™å¸ˆæ•°é‡<br><strong style="font-size: 24px;" id="teacher-count">125+</strong>
      </div>
      <div class="stat-card" style="background: #f59e0b;">
        ğŸ“š è¯¾ç¨‹æ€»æ•°<br><strong style="font-size: 24px;" id="course-count">230+</strong>
      </div>
      <div class="stat-card" style="background: #ec4899;">
        ğŸ§  çŸ¥è¯†ç‚¹æ•°é‡<br><strong style="font-size: 24px;" id="knowledge-count">5420+</strong>
      </div>
    </div>

    <script>
      // è°ƒç”¨ API è·å–æ•°æ®
      async function fetchData() {
        try {
          const response = await fetch('http://localhost:5000/api/indexSum');
          if (!response.ok) throw new Error('ç½‘ç»œå“åº”å¤±è´¥');

          const responseData = await response.json();
          if (responseData.success) {
            const [userCount, teacherCount, courseCount, knowledgeCount] = responseData.data;
            document.getElementById('user-count').textContent = userCount + "+";
            document.getElementById('teacher-count').textContent = teacherCount + "+";
            document.getElementById('course-count').textContent = courseCount + "+";
            document.getElementById('knowledge-count').textContent = knowledgeCount + "+";
          }
        } catch (error) {
          console.error('è¯·æ±‚å¤±è´¥:', error);
        }
      }
      document.addEventListener('DOMContentLoaded', fetchData);
    </script>

<!--    <div style="background: #fff; padding: 20px; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">-->
<!--      <h3 style="margin-top: 0;">ğŸ“¢ ç³»ç»Ÿå…¬å‘Š</h3>-->
<!--      <ul style="padding-left: 20px; color: #333;">-->
<!--        <li>2025-04-01ï¼šæ–°å¢æ•™å¸ˆå›¾è°±å¯¼å…¥åŠŸèƒ½ï¼Œæ”¯æŒä¸€é”®ä¸Šä¼ æ•™å­¦å…³ç³»ã€‚</li>-->
<!--        <li>2025-03-20ï¼šç³»ç»Ÿä¸Šçº¿æµ‹è¯•ç‰ˆï¼Œæ¬¢è¿è¯•ç”¨å¹¶åé¦ˆé—®é¢˜ã€‚</li>-->
<!--        <li>2025-03-10ï¼šå®Œæˆå­¦ç”Ÿ-è¯¾ç¨‹-çŸ¥è¯†ç‚¹å…³è”å…³ç³»æ„å»ºã€‚</li>-->
<!--      </ul>-->
<!--    </div>-->
    <div style="background: #fff; padding: 20px; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
      <img src="{{ url_for('static', filename='img/index.jpg') }}" alt="User Avatar" style="width: 100%; height: auto; border-radius: 10px;" />
    </div>
  </div>

  <!-- å¯è§†å›¾è¡¨å†…å®¹ -->
  <div id="chart" class="page">
    <h1>æœ€çƒ­é—¨çš„è¯¾ç¨‹top10</h1>
    <div class="chart-container">
      <div id="chart1" class="chart"></div>
      <div class="chart-description">
        <h3>è¯¾ç¨‹æ•°é‡åˆ†æ</h3>
        <p>æœ¬å›¾è¡¨å±•ç¤ºäº†å„å­¦ç§‘çš„è¯¾ç¨‹æ•°é‡åˆ†å¸ƒæƒ…å†µã€‚ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼š</p>
        <ul>
          <li>è¯­æ–‡å’Œæ•°å­¦è¯¾ç¨‹æ•°é‡æœ€å¤š</li>
          <li>ç†ç§‘è¯¾ç¨‹æ•°é‡ç›¸å¯¹å‡è¡¡</li>
          <li>è‹±è¯­è¯¾ç¨‹æ•°é‡ä½å±…ç¬¬ä¸‰</li>
        </ul>
      </div>
    </div>

    <h1>æœ€å†·é—¨çš„è¯¾ç¨‹top10</h1>
    <div class="chart-container">
      <div id="chart2" class="chart"></div>
      <div class="chart-description">
        <h3>çŸ¥è¯†ç‚¹åˆ†å¸ƒåˆ†æ</h3>
        <p>æœ¬å›¾è¡¨å±•ç¤ºäº†å„ç±»çŸ¥è¯†ç‚¹çš„å æ¯”æƒ…å†µï¼š</p>
        <ul>
          <li>åŸºç¡€æ¦‚å¿µå æ¯”çº¦30%</li>
          <li>å…¬å¼å®šç†å æ¯”çº¦25%</li>
          <li>åº”ç”¨æŠ€èƒ½å æ¯”çº¦20%</li>
          <li>ç»¼åˆèƒ½åŠ›å æ¯”çº¦15%</li>
          <li>æ‹“å±•çŸ¥è¯†å æ¯”çº¦10%</li>
        </ul>
      </div>
    </div>

    <h1>ä¸Šè¯¾æ¬¡æ•°æœ€å¤šè€å¸ˆtop10</h1>
    <div class="chart-container">
      <div id="chart3" class="chart"></div>
      <div class="chart-description">
        <h3>æ•™å­¦å…³ç³»åˆ†æ</h3>
        <p>æœ¬å›¾è¡¨å±•ç¤ºäº†æ•™å¸ˆã€è¯¾ç¨‹å’Œå­¦ç”Ÿä¹‹é—´çš„å…³ç³»ç½‘ç»œï¼š</p>
        <ul>
          <li>å¼ è€å¸ˆè´Ÿè´£é«˜ç­‰æ•°å­¦è¯¾ç¨‹</li>
          <li>æè€å¸ˆè´Ÿè´£å¤§å­¦è‹±è¯­è¯¾ç¨‹</li>
          <li>å­¦ç”ŸAåŒæ—¶é€‰ä¿®äº†æ•°å­¦å’Œè‹±è¯­</li>
          <li>å­¦ç”ŸBåªé€‰ä¿®äº†æ•°å­¦è¯¾ç¨‹</li>
        </ul>
      </div>
    </div>

    <h1>çƒ­é—¨è¯¾ç¨‹å…³é”®è¯</h1>
    <div class="chart-container">
      <div id="chart4" class="chart"></div>
      <div class="chart-description">
        <h3>æ•™å­¦å…³ç³»åˆ†æ</h3>
        <p>æœ¬å›¾è¡¨å±•ç¤ºäº†æ•™å¸ˆã€è¯¾ç¨‹å’Œå­¦ç”Ÿä¹‹é—´çš„å…³ç³»ç½‘ç»œï¼š</p>
        <ul>
          <li>å¼ è€å¸ˆè´Ÿè´£é«˜ç­‰æ•°å­¦è¯¾ç¨‹</li>
          <li>æè€å¸ˆè´Ÿè´£å¤§å­¦è‹±è¯­è¯¾ç¨‹</li>
          <li>å­¦ç”ŸAåŒæ—¶é€‰ä¿®äº†æ•°å­¦å’Œè‹±è¯­</li>
          <li>å­¦ç”ŸBåªé€‰ä¿®äº†æ•°å­¦è¯¾ç¨‹</li>
        </ul>
      </div>
    </div>

    <h1>5</h1>
    <div class="chart-container">
      <div id="chart5" class="chart"></div>
      <div class="chart-description">
        <h3>æ•™å­¦å…³ç³»åˆ†æ</h3>
        <p>æœ¬å›¾è¡¨å±•ç¤ºäº†æ•™å¸ˆã€è¯¾ç¨‹å’Œå­¦ç”Ÿä¹‹é—´çš„å…³ç³»ç½‘ç»œï¼š</p>
        <ul>
          <li>å¼ è€å¸ˆè´Ÿè´£é«˜ç­‰æ•°å­¦è¯¾ç¨‹</li>
          <li>æè€å¸ˆè´Ÿè´£å¤§å­¦è‹±è¯­è¯¾ç¨‹</li>
          <li>å­¦ç”ŸAåŒæ—¶é€‰ä¿®äº†æ•°å­¦å’Œè‹±è¯­</li>
          <li>å­¦ç”ŸBåªé€‰ä¿®äº†æ•°å­¦è¯¾ç¨‹</li>
        </ul>
      </div>
    </div>

    <h1>ä¸åŒå­¦é™¢çš„è¯¾ç¨‹æ•°é‡</h1>
    <div class="chart-container">
      <div id="chart6" class="chart"></div>
      <div class="chart-description">
        <h3>æ•™å­¦å…³ç³»åˆ†æ</h3>
        <p>æœ¬å›¾è¡¨å±•ç¤ºäº†æ•™å¸ˆã€è¯¾ç¨‹å’Œå­¦ç”Ÿä¹‹é—´çš„å…³ç³»ç½‘ç»œï¼š</p>
        <ul>
          <li>å¼ è€å¸ˆè´Ÿè´£é«˜ç­‰æ•°å­¦è¯¾ç¨‹</li>
          <li>æè€å¸ˆè´Ÿè´£å¤§å­¦è‹±è¯­è¯¾ç¨‹</li>
          <li>å­¦ç”ŸAåŒæ—¶é€‰ä¿®äº†æ•°å­¦å’Œè‹±è¯­</li>
          <li>å­¦ç”ŸBåªé€‰ä¿®äº†æ•°å­¦è¯¾ç¨‹</li>
        </ul>
      </div>
    </div>



  </div>

<!--now !!-->
<!--  <div id="data" class="page">-->
<!--    <div class="data-management-section">-->
<!--      <h1>è¯¾ç¨‹ä¿¡æ¯ç®¡ç†</h1>-->

<!--      <form id="course-form" action="/submit-course" method="POST">-->
<!--        &lt;!&ndash; è¯¾ç¨‹è¾“å…¥ &ndash;&gt;-->
<!--        <div>-->
<!--          <label for="course_name">è¯¾ç¨‹åç§°</label>-->
<!--          <input type="text" id="course_name" name="course_name" placeholder="è¯·è¾“å…¥è¯¾ç¨‹åç§°" required>-->
<!--        </div>-->

<!--        &lt;!&ndash; æ•™å¸ˆè¾“å…¥ï¼ˆå¤šä¸ªæ•™å¸ˆï¼‰&ndash;&gt;-->
<!--        <div style="grid-column: span 2;">-->
<!--          <label>æ•™å¸ˆä¿¡æ¯</label>-->
<!--          <div class="instructors-container" id="instructor-inputs">-->
<!--            <div class="instructor-input">-->
<!--              <input type="text" name="instructor_name[]" placeholder="è¯·è¾“å…¥æ•™å¸ˆå§“å" required>-->
<!--            </div>-->
<!--          </div>-->
<!--          <button type="button" class="add-instructor-btn" onclick="addInstructor()">-->
<!--            + æ·»åŠ æ›´å¤šæ•™å¸ˆ-->
<!--          </button>-->
<!--        </div>-->

<!--        &lt;!&ndash; å­¦æ ¡è¾“å…¥ &ndash;&gt;-->
<!--        <div>-->
<!--          <label for="school_name">æ‰€å±å­¦æ ¡</label>-->
<!--          <input type="text" id="school_name" name="school_name" placeholder="è¯·è¾“å…¥å­¦æ ¡åç§°" required>-->
<!--        </div>-->

<!--        &lt;!&ndash; æäº¤æŒ‰é’® &ndash;&gt;-->
<!--        <div style="grid-column: span 2;">-->
<!--          <button type="submit">æäº¤æ•°æ®</button>-->
<!--        </div>-->
<!--      </form>-->

<!--      &lt;!&ndash; åé¦ˆæ¶ˆæ¯æ˜¾ç¤ºåŒºåŸŸ &ndash;&gt;-->
<!--      <div id="feedback-message"></div>-->
<!--    </div>-->
<!--  </div>-->
  <div id="data" class="page" style="width: 94%; max-width: 1600px; margin: 0 auto; background: white; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.08); padding: 35px;">
    <!-- è£…é¥°æ€§å…ƒç´  -->
    <div style="position: absolute; top: 0; left: 0; width: 8px; height: 100%; background: linear-gradient(to bottom, #5c6bc0, #8e99f3); border-radius: 12px 0 0 12px;"></div>
    <div style="position: absolute; top: 0; right: 0; width: 8px; height: 100%; background: linear-gradient(to bottom, #5c6bc0, #8e99f3); border-radius: 0 12px 12px 0;"></div>

    <div class="data-management-section" style="display: flex; flex-direction: column; gap: 30px;">
      <div style="text-align: center;">
        <h1 style="color: #5c6bc0; margin-bottom: 10px; font-weight: 600; font-size: 28px;">è¯¾ç¨‹ä¿¡æ¯ç®¡ç†</h1>
        <div style="height: 3px; width: 60px; background: linear-gradient(to right, #5c6bc0, #8e99f3); margin: 0 auto; border-radius: 3px;"></div>
      </div>

      <form id="course-form" action="/submit-course" method="POST" style="display: grid; grid-template-columns: 1fr; gap: 25px;">
        <!-- è¯¾ç¨‹è¾“å…¥æ¨¡å— -->
        <div style="border: 1px solid #e0e0e0; border-radius: 8px; padding: 25px; background-color: #f8f9fa; position: relative;">
          <div style="position: absolute; top: -10px; left: 20px; background: white; padding: 0 10px; color: #5c6bc0; font-weight: 500;">è¯¾ç¨‹ä¿¡æ¯</div>
          <label for="course_name" style="font-weight: 500; color: #555; margin-bottom: 12px; display: block;">è¯¾ç¨‹åç§°</label>
          <input type="text" id="course_name" name="course_name" placeholder="è¯·è¾“å…¥è¯¾ç¨‹åç§°" required
                 style="padding: 14px 16px; border: 1px solid #dee2e6; border-radius: 6px; font-size: 16px; transition: all 0.3s ease; width: 100%; box-sizing: border-box;">
        </div>

        <!-- æ•™å¸ˆè¾“å…¥æ¨¡å— -->
        <div style="border: 1px solid #e0e0e0; border-radius: 8px; padding: 25px; background-color: #f8f9fa; position: relative;">
          <div style="position: absolute; top: -10px; left: 20px; background: white; padding: 0 10px; color: #5c6bc0; font-weight: 500;">æ•™å¸ˆä¿¡æ¯</div>
          <label style="font-weight: 500; color: #555; margin-bottom: 12px; display: block;">æ•™å¸ˆåˆ—è¡¨</label>
          <div class="instructors-container" id="instructor-inputs" style="display: flex; flex-direction: column; gap: 12px; margin-bottom: 15px;">
            <div class="instructor-input" style="display: flex; gap: 12px; align-items: center;">
              <input type="text" name="instructor_name[]" placeholder="è¯·è¾“å…¥æ•™å¸ˆå§“å" required
                     style="padding: 14px 16px; border: 1px solid #dee2e6; border-radius: 6px; font-size: 16px; transition: all 0.3s ease; width: 100%; box-sizing: border-box;">
              <button type="button" onclick="this.parentElement.remove()"
                      style="background: none; border: none; color: #dc3545; font-size: 22px; cursor: pointer; padding: 5px 10px; flex-shrink: 0;">Ã—</button>
            </div>
          </div>
          <button type="button" class="add-instructor-btn" onclick="addInstructor()"
                  style="padding: 14px 16px; border: 1px dashed #5c6bc0; border-radius: 6px; font-size: 16px; transition: all 0.3s ease; width: 100%; box-sizing: border-box; background-color: rgba(92, 107, 192, 0.05); color: #5c6bc0; text-align: center; font-weight: 500;">
            <span style="font-size: 18px;">+</span> æ·»åŠ æ›´å¤šæ•™å¸ˆ
          </button>
        </div>

        <!-- å­¦æ ¡è¾“å…¥æ¨¡å— -->
        <div style="border: 1px solid #e0e0e0; border-radius: 8px; padding: 25px; background-color: #f8f9fa; position: relative;">
          <div style="position: absolute; top: -10px; left: 20px; background: white; padding: 0 10px; color: #5c6bc0; font-weight: 500;">å­¦æ ¡ä¿¡æ¯</div>
          <label for="school_name" style="font-weight: 500; color: #555; margin-bottom: 12px; display: block;">æ‰€å±å­¦æ ¡</label>
          <input type="text" id="school_name" name="school_name" placeholder="è¯·è¾“å…¥å­¦æ ¡åç§°" required
                 style="padding: 14px 16px; border: 1px solid #dee2e6; border-radius: 6px; font-size: 16px; transition: all 0.3s ease; width: 100%; box-sizing: border-box;">
        </div>
        <div style="border: 1px solid #e0e0e0; border-radius: 8px; padding: 25px; background-color: #f8f9fa; position: relative;">
          <div style="position: absolute; top: -10px; left: 20px; background: white; padding: 0 10px; color: #5c6bc0; font-weight: 500;">å¼€å§‹æ—¥æœŸ</div>
          <label for="start_date" style="font-weight: 500; color: #555; margin-bottom: 12px; display: block;">è¯·é€‰æ‹©è¯¾ç¨‹å¼€å§‹æ—¶é—´</label>
          <input type="date" id="start_date" name="start_date" required
                 style="padding: 14px 16px; border: 1px solid #dee2e6; border-radius: 6px; font-size: 16px; transition: all 0.3s ease; width: 100%; box-sizing: border-box;">
        </div>

        <!-- ç»“æŸæ—¥æœŸè¾“å…¥æ¨¡å— -->
        <div style="border: 1px solid #e0e0e0; border-radius: 8px; padding: 25px; background-color: #f8f9fa; position: relative;">
          <div style="position: absolute; top: -10px; left: 20px; background: white; padding: 0 10px; color: #5c6bc0; font-weight: 500;">ç»“æŸæ—¥æœŸ</div>
          <label for="end_date" style="font-weight: 500; color: #555; margin-bottom: 12px; display: block;">è¯·é€‰æ‹©è¯¾ç¨‹ç»“æŸæ—¶é—´</label>
          <input type="date" id="end_date" name="end_date" required
                 style="padding: 14px 16px; border: 1px solid #dee2e6; border-radius: 6px; font-size: 16px; transition: all 0.3s ease; width: 100%; box-sizing: border-box;">
        </div>

        <!-- æ³¨å†Œäººæ•°è¾“å…¥æ¨¡å— -->
        <div style="border: 1px solid #e0e0e0; border-radius: 8px; padding: 25px; background-color: #f8f9fa; position: relative;">
          <div style="position: absolute; top: -10px; left: 20px; background: white; padding: 0 10px; color: #5c6bc0; font-weight: 500;">æ³¨å†Œäººæ•°</div>
          <label for="enrollment_count" style="font-weight: 500; color: #555; margin-bottom: 12px; display: block;">è¯·è¾“å…¥æ³¨å†Œäººæ•°</label>
          <input type="number" id="enrollment_count" name="enrollment_count" min="0" placeholder="ä¾‹å¦‚ï¼š120" required
                 style="padding: 14px 16px; border: 1px solid #dee2e6; border-radius: 6px; font-size: 16px; transition: all 0.3s ease; width: 100%; box-sizing: border-box;">
        </div>

        <div style="border: 1px solid #e0e0e0; border-radius: 8px; padding: 25px; background-color: #f8f9fa; position: relative;">
          <div style="position: absolute; top: -10px; left: 20px; background: white; padding: 0 10px; color: #5c6bc0; font-weight: 500;">å¼€è¯¾æ¬¡æ•°</div>
          <label for="classSum" style="font-weight: 500; color: #555; margin-bottom: 12px; display: block;">è¯·è¾“å…¥å¼€è¯¾æ¬¡æ•°</label>
          <input type="number" id="classSum" name="course_open_count" min="0" placeholder="ä¾‹å¦‚ï¼š6" required
                 style="padding: 14px 16px; border: 1px solid #dee2e6; border-radius: 6px; font-size: 16px; transition: all 0.3s ease; width: 100%; box-sizing: border-box;">
        </div>

        <!-- æäº¤æŒ‰é’®æ¨¡å— -->
        <div style="text-align: center; margin-top: 10px;">
          <button type="submit"
                  style="padding: 14px 40px; background: linear-gradient(to right, #5c6bc0, #8e99f3); color: white; border: none; border-radius: 6px; font-size: 16px; font-weight: 500; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 4px 12px rgba(92, 107, 192, 0.25);">
            æäº¤æ•°æ®
          </button>
        </div>
      </form>

      <!-- åé¦ˆæ¶ˆæ¯æ˜¾ç¤ºåŒºåŸŸ -->
      <div id="feedback-message" style="display: none; padding: 15px; border-radius: 6px; margin-top: 20px; text-align: center; font-weight: 500;"></div>
    </div>
  </div>

  <script>
    // åŠ¨æ€æ·»åŠ æ•™å¸ˆè¾“å…¥æ¡†
    function addInstructor() {
      const instructorContainer = document.getElementById("instructor-inputs");
      const newInputDiv = document.createElement("div");
      newInputDiv.className = "instructor-input";
      newInputDiv.style.display = "flex";
      newInputDiv.style.gap = "12px";
      newInputDiv.style.alignItems = "center";
      newInputDiv.style.marginBottom = "12px";

      newInputDiv.innerHTML = `
      <input type="text" name="instructor_name[]" placeholder="è¯·è¾“å…¥æ•™å¸ˆå§“åï¼ˆå¿…å¡«ï¼‰" required
             style="padding: 14px 16px; border: 1px solid #dee2e6; border-radius: 6px;
                    font-size: 16px; transition: all 0.3s ease; width: 100%; box-sizing: border-box;">
      <button type="button" onclick="this.parentElement.remove()"
              style="background: none; border: none; color: #dc3545; font-size: 22px;
                    cursor: pointer; padding: 5px 10px; flex-shrink: 0;">Ã—</button>
    `;
      instructorContainer.appendChild(newInputDiv);
      newInputDiv.querySelector("input").focus();
    }

    // å¤„ç†è¡¨å•æäº¤
    document.getElementById("course-form").addEventListener("submit", async function(event) {
      event.preventDefault();

      const feedbackDiv = document.getElementById("feedback-message");
      feedbackDiv.style.display = "block";
      feedbackDiv.textContent = "æäº¤ä¸­ï¼Œè¯·ç¨å€™...";
      feedbackDiv.style.backgroundColor = "#f8f9fa";
      feedbackDiv.style.color = "#333";

      try {
        // éªŒè¯å¿…å¡«å­—æ®µ
        const courseName = document.getElementById("course_name").value.trim();
        const schoolName = document.getElementById("school_name").value.trim();
        const startDate = document.getElementById("start_date").value;
        const endDate = document.getElementById("end_date").value;

        if (!courseName || !schoolName || !startDate || !endDate) {
          throw new Error("è¯¾ç¨‹åç§°ã€å­¦æ ¡åç§°å’Œæ—¥æœŸéƒ½æ˜¯å¿…å¡«é¡¹");
        }

        // æ”¶é›†æ‰€æœ‰æ•™å¸ˆå§“åï¼ˆç¡®ä¿è‡³å°‘æœ‰ä¸€ä¸ªæ•™å¸ˆï¼‰
        const instructorInputs = Array.from(document.querySelectorAll('[name="instructor_name[]"]'));
        const instructorNames = instructorInputs
                .map(input => input.value.trim())
                .filter(name => name !== "");

        if (instructorNames.length === 0) {
          throw new Error("è‡³å°‘éœ€è¦å¡«å†™ä¸€ä½æ•™å¸ˆ");
        }

        // æ„å»ºè¯·æ±‚æ•°æ®
        const requestData = {
          course_names: [courseName],
          instructor_names_list: [instructorNames], // äºŒç»´æ•°ç»„
          school_names: [schoolName],
          start_dates: [startDate],
          end_dates: [endDate],
          enrollment_counts: [parseInt(document.getElementById("enrollment_count").value) || 0],
          course_open_counts: [parseInt(document.getElementById("classSum").value) || 1]
        };

        console.log("æäº¤æ•°æ®:", JSON.stringify(requestData, null, 2));

        // å‘é€è¯·æ±‚
        const response = await fetch('/submit-course', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(requestData)
        });

        const result = await response.json();

        if (result.success) {
          feedbackDiv.textContent = result.message || "æ•°æ®æäº¤æˆåŠŸï¼";
          feedbackDiv.style.backgroundColor = "#d4edda";
          feedbackDiv.style.color = "#155724";

          setTimeout(() => {
            feedbackDiv.style.display = "none";
            event.target.reset();
          }, 3000);
        } else {
          throw new Error(result.message || "æäº¤å¤±è´¥");
        }
      } catch (error) {
        console.error("æäº¤é”™è¯¯:", error);
        feedbackDiv.textContent = error.message || "æäº¤å‡ºé”™ï¼Œè¯·æ£€æŸ¥æ•°æ®åé‡è¯•";
        feedbackDiv.style.backgroundColor = "#f8d7da";
        feedbackDiv.style.color = "#721c24";
      }
    });

    // åˆå§‹åŠ è½½æ—¶ç¡®ä¿è‡³å°‘æœ‰ä¸€ä¸ªæ•™å¸ˆè¾“å…¥æ¡†
    document.addEventListener('DOMContentLoaded', function() {
      if (document.querySelectorAll('[name="instructor_name[]"]').length === 0) {
        addInstructor();
      }
    });
  </script>
  <div id="query" class="page" style="
    max-width: 1600px;
    margin: 20px auto;
    background: white;
    border-radius: 12px;
    box-shadow:
        0 6px 18px rgba(0, 0, 0, 0.08),
        0 0 0 1px rgba(0, 0, 0, 0.04),
        inset 0 0 0 1px rgba(255, 255, 255, 0.8);
    padding: 20px;
    position: relative;
    border: 1px solid #e0e0e0;
    border-top: 1px solid #f0f0f0;
    border-bottom: 1px solid #d0d0d0;
    background-color: #fafafa;
    ">
    <h2 style="color: #5c6bc0; margin-bottom: 10px; font-weight: 600; font-size: 28px; text-align: center;">
      çŸ¥è¯†å›¾è°±æŸ¥è¯¢
    </h2>
    <div id="heng" style="height: 3px; width: 60px; background: linear-gradient(to right, #5c6bc0, #8e99f3); margin: 0 auto; border-radius: 3px;"></div>
    <!-- æœç´¢ç±»å‹é€‰æ‹© -->
    <div class="search-type" id="searchType" style="margin-top: 30px; text-align: center;">
      <button id="searchCourseBtn" class="active" onclick="setSearchType('course')" style="padding: 10px 20px; font-size: 16px; background-color: #5c6bc0; color: white; border: none; border-radius: 5px; cursor: pointer; margin-right: 10px;">
        è¯¾ç¨‹æŸ¥è¯¢</button>
      <button id="searchTeacherBtn" onclick="setSearchType('teacher')" style="padding: 10px 20px; font-size: 16px; background-color: #5c6bc0; color: white; border: none; border-radius: 5px; cursor: pointer;">
        æ•™å¸ˆæŸ¥è¯¢
      </button>
    </div>

    <!-- è¯¾ç¨‹æŸ¥è¯¢éƒ¨åˆ† -->
    <div id="courseSearch" class="search-section" style="margin-top: 30px;">
      <h3 style="font-size: 24px; color: #333;" align="center">è¾“å…¥è¯¾ç¨‹åç§°æŸ¥è¯¢ç›¸å…³è¯¾ç¨‹</h3>
      <div class="search-box" style="display: flex; justify-content: center; gap: 10px; margin-top: 15px;">
        <input type="text" id="courseName" placeholder="è¾“å…¥è¯¾ç¨‹åç§°" style="padding: 10px 15px; width: 300px; font-size: 16px; border-radius: 5px; border: 1px solid #ccc;">
        <button onclick="searchCourse()" id="button1" style="padding: 10px 20px; background-color: #5c6bc0; color: white; border: none; border-radius: 5px; font-size: 16px; cursor: pointer;">
          æŸ¥è¯¢è¯¾ç¨‹
        </button>

      </div>
    </div>

    <!-- æ•™å¸ˆæŸ¥è¯¢éƒ¨åˆ† -->
    <div id="teacherSearch" class="search-section" style="display:none; margin-top: 30px;">
      <h3 style="font-size: 24px; color: #333;" align="center">è¾“å…¥æ•™å¸ˆå§“åæŸ¥è¯¢æ•™å­¦å…³ç³»</h3>
      <div class="search-box" style="display: flex; justify-content: center; gap: 10px; margin-top: 15px;">
        <input type="text" id="teacherName" placeholder="è¾“å…¥æ•™å¸ˆå§“å" style="padding: 10px 15px; width: 300px; font-size: 16px; border-radius: 5px; border: 1px solid #ccc;">
        <button onclick="searchTeacher()" id="button2" style="padding: 10px 20px; background-color: #5c6bc0; color: white; border: none; border-radius: 5px; font-size: 16px; cursor: pointer;">æŸ¥è¯¢æ•™å¸ˆ</button>
      </div>
    </div>

    <!-- å¯è§†åŒ–å®¹å™¨ -->
    <div id="graph-container" style="margin-top: 40px;">
      <div id="graph" style="width:100%; height:600px; border-radius: 10px; background-color: #ffffff; border: 1px solid #ddd;"></div>
      <div id="graph-info" style="margin-top: 20px; font-size: 16px; color: #333;"></div>
    </div>
    <div id="heng2" style="height: 3px; width: 60px; background: linear-gradient(to right, #5c6bc0, #8e99f3); margin: 0 auto; border-radius: 3px;"></div>
<!--    </div>-->
  <!--    <style>-->
<!--      .search-type {-->
<!--        margin: 20px 0;-->
<!--        display: flex;-->
<!--        gap: 10px;-->
<!--      }-->
<!--      .search-type button {-->
<!--        padding: 8px 16px;-->
<!--        background: #f0f0f0;-->
<!--        border: 1px solid #ddd;-->
<!--        border-radius: 4px;-->
<!--        cursor: pointer;-->
<!--      }-->
<!--      .search-type button.active {-->
<!--        background: #4A90E2;-->
<!--        color: white;-->
<!--        border-color: #4A90E2;-->
<!--      }-->
<!--      .search-section {-->
<!--        margin-bottom: 20px;-->
<!--      }-->
<!--      .search-box {-->
<!--        display: flex;-->
<!--        gap: 10px;-->
<!--        max-width: 500px;-->
<!--      }-->
<!--      .search-box input {-->
<!--        flex: 1;-->
<!--        padding: 8px;-->
<!--        border: 1px solid #ddd;-->
<!--        border-radius: 4px;-->
<!--      }-->
<!--      .search-box button {-->
<!--        padding: 8px 16px;-->
<!--        background: #4A90E2;-->
<!--        color: white;-->
<!--        border: none;-->
<!--        border-radius: 4px;-->
<!--        cursor: pointer;-->
<!--      }-->
<!--      #graph-container {-->
<!--        margin-top: 20px;-->
<!--        border: 1px solid #eee;-->
<!--        border-radius: 4px;-->
<!--        padding: 10px;-->
<!--        background: white;-->
<!--      }-->
<!--      #graph-info {-->
<!--        margin-top: 10px;-->
<!--        padding: 10px;-->
<!--        background: #f9f9f9;-->
<!--        border-radius: 4px;-->
<!--        font-size: 14px;-->
<!--      }-->
<!--    </style>-->

    <script>
      document.addEventListener('DOMContentLoaded', function() {
        // è®¾ç½®æœç´¢ç±»å‹
        window.setSearchType = function(type) {
          document.getElementById('searchCourseBtn').classList.remove('active');
          document.getElementById('searchTeacherBtn').classList.remove('active');
          document.getElementById('courseSearch').style.display = 'none';
          document.getElementById('teacherSearch').style.display = 'none';

          if (type === 'course') {
            document.getElementById('searchCourseBtn').classList.add('active');
            document.getElementById('courseSearch').style.display = 'block';
          } else {
            document.getElementById('searchTeacherBtn').classList.add('active');
            document.getElementById('teacherSearch').style.display = 'block';
          }

          // æ¸…ç©ºå›¾å½¢å’Œè¾“å…¥æ¡†
          document.getElementById('graph').innerHTML = '';
          document.getElementById('graph-info').innerHTML = '';
        };

        // è¯¾ç¨‹æŸ¥è¯¢å‡½æ•°
        window.searchCourse = function() {
          const courseName = document.getElementById("courseName").value.trim();
          if (!courseName) {
            alert("è¯·è¾“å…¥è¯¾ç¨‹åç§°ï¼");
            return;
          }

          showLoading(true, `æ­£åœ¨æŸ¥è¯¢è¯¾ç¨‹: ${courseName}`);

          // å…ˆæ»šåŠ¨åˆ°å›¾å½¢åŒºåŸŸ
          scrollToGraph();

          fetch(`http://localhost:5000/api/searchClass?course_name=${encodeURIComponent(courseName)}`)
                  .then(handleResponse)
                  .then(data => {
                    if (!data || !data.course_name) {
                      throw new Error('è¿”å›æ•°æ®æ ¼å¼ä¸æ­£ç¡®ï¼Œç¼ºå°‘course_nameå­—æ®µ');
                    }
                    drawCourseGraph(data);
                    showGraphInfo(data);
                  })
                  .catch(handleError);
        };

        // æ•™å¸ˆæŸ¥è¯¢å‡½æ•°
        window.searchTeacher = function() {
          const teacherName = document.getElementById("teacherName").value.trim();
          if (!teacherName) {
            alert("è¯·è¾“å…¥æ•™å¸ˆå§“åï¼");
            return;
          }

          showLoading(true, `æ­£åœ¨æŸ¥è¯¢æ•™å¸ˆ: ${teacherName}`);

          // å…ˆæ»šåŠ¨åˆ°å›¾å½¢åŒºåŸŸ
          scrollToGraph();

          fetch(`http://localhost:5000/api/searchTeacher?teacher_name=${encodeURIComponent(teacherName)}`)
                  .then(handleResponse)
                  .then(data => {
                    if (!data || !data.teacher) {
                      throw new Error('è¿”å›æ•°æ®æ ¼å¼ä¸æ­£ç¡®ï¼Œç¼ºå°‘teacherå­—æ®µ');
                    }
                    drawTeacherGraph(data);
                    showGraphInfo(data);
                  })
                  .catch(handleError);
        };

        // æ»šåŠ¨åˆ°å›¾å½¢åŒºåŸŸçš„å‡½æ•°
        function scrollToGraph() {
          const graphSection = document.getElementById('graph-section');
          if (graphSection) {
            graphSection.scrollIntoView({
              behavior: 'smooth',
              block: 'start'
            });

            // å¦‚æœæœ‰å›ºå®šå¯¼èˆªæ ï¼Œå¯ä»¥æ·»åŠ åç§»é‡
            // window.scrollBy(0, -50);
          }
        }

        // é€šç”¨å“åº”å¤„ç†
        function handleResponse(response) {
          if (!response.ok) {
            throw new Error('ç½‘ç»œå“åº”ä¸æ­£å¸¸');
          }
          return response.json();
        }

        // é”™è¯¯å¤„ç†
        function handleError(error) {
          console.error("æŸ¥è¯¢é”™è¯¯:", error);
          showLoading(false);
          alert("æŸ¥è¯¢å¤±è´¥: " + error.message);
        }

        // æ˜¾ç¤º/éšè—åŠ è½½çŠ¶æ€
        function showLoading(show, message = '') {
          const infoDiv = document.getElementById('graph-info');
          infoDiv.innerHTML = show ? `<div class="loading">${message}...</div>` : '';
        }

        // æ˜¾ç¤ºå›¾å½¢ä¿¡æ¯
        function showGraphInfo(data) {
          showLoading(false);
          let info = "";

// åˆ¤æ–­æ˜¯å¦æœ‰è¯¾ç¨‹æ•°æ®
          if (data.course_name) {
            info += `<p>è¯¾ç¨‹: <strong>${data.course_name}</strong></p>`;
            if (data.teachers) {
              info += `<p>æˆè¯¾æ•™å¸ˆ: ${data.teachers.join(', ')}</p>`;
            }
            if (data.related_courses) {
              info += `<p>ç›¸å…³è¯¾ç¨‹: ${data.related_courses.join(', ')}</p>`;
            }


            // // ç¡®ä¿é¡µé¢åŠ è½½å®Œæˆåæ‰§è¡Œ
            // document.addEventListener('DOMContentLoaded', function() {
            //   // è·å–æŒ‰é’®å…ƒç´ 
            //   const button = document.getElementById("scrollToTop");
            //   // ç¡®ä¿æŒ‰é’®å­˜åœ¨
            //   if (button) {
            //     // æ·»åŠ ç‚¹å‡»äº‹ä»¶ç›‘å¬
            //     button.addEventListener('click', function() {
            //       console.log('æŒ‰é’®å·²ç‚¹å‡»');  // è°ƒè¯•ä¿¡æ¯
            //       window.scrollTo({
            //         top: 0,           // æ»šåŠ¨åˆ°é¡µé¢é¡¶éƒ¨
            //         behavior: 'smooth' // å¹³æ»‘æ»šåŠ¨
            //       });
            //     });
            //   } else {
            //     console.log('æŒ‰é’®æœªæ‰¾åˆ°');
            //   }
            // });

// åˆ¤æ–­æ˜¯å¦æœ‰æ•™å¸ˆæ•°æ®
          } else if (data.teacher) {
            info += `<p>æ•™å¸ˆ: <strong>${data.teacher.name}</strong></p>`;
            if (data.courses) {
              const courses = data.courses.map(c => c.course).join(', ');
              info += `<p>æ•™æˆè¯¾ç¨‹: ${courses}</p>`;
            }
            if (data.school) {
              info += `<p>æ‰€å±å­¦é™¢: ${data.school.name}</p>`;
            }

            // ç”ŸæˆæŒ‰é’®å¹¶ç»‘å®šäº‹ä»¶ï¼Œç‚¹å‡»æŒ‰é’®åæ»šåŠ¨åˆ°é¡µé¢é¡¶éƒ¨
  //           info += `
  //           <button id="scrollToTop" style="padding: 10px 20px; background-color: #5c6bc0; color: white; border: none; border-radius: 5px; font-size: 16px; cursor: pointer; margin-top: 15px;">
  //               æ»šåŠ¨åˆ°é¡µé¢é¡¶éƒ¨
  //            </button>
  // `;

            // æ·»åŠ äº‹ä»¶ç›‘å¬ï¼Œç‚¹å‡»æŒ‰é’®æ»šåŠ¨åˆ°é¡µé¢é¡¶éƒ¨
            document.getElementById('scrollToTop')?.addEventListener('click', function() {
              window.scrollTo({
                top: 0,           // æ»šåŠ¨åˆ°é¡µé¢é¡¶éƒ¨
                behavior: 'smooth' // å¹³æ»‘æ»šåŠ¨
              });
            });
          }


          document.getElementById('graph-info').innerHTML = info;
        }

        // ç»˜åˆ¶è¯¾ç¨‹å…³ç³»å›¾
        function drawCourseGraph(data) {
          const nodes = new vis.DataSet();
          const edges = new vis.DataSet();

          // æ·»åŠ ä¸»è¯¾ç¨‹èŠ‚ç‚¹
          nodes.add(createNode(data.course_name, {
            shape: 'box',
            color: '#4A90E2',
            size: 25,
            font: { size: 16, bold: true },
            borderWidth: 3,
            shadow: true
          }));

          // æ·»åŠ ç›¸å…³è¯¾ç¨‹
          if (data.related_courses && data.course_relationships) {
            const minLength = Math.min(data.related_courses.length, data.course_relationships.length);
            for (let i = 0; i < minLength; i++) {
              const course = data.related_courses[i];
              nodes.add(createNode(course, {
                shape: 'box',
                color: '#97C2FC',
                font: { size: 14 }
              }));

              // ä¸ºæ¯ä¸ªå…³ç³»æ·»åŠ è¾¹ï¼Œå¢åŠ å¼§åº¦å’Œé•¿åº¦å˜åŒ–
              data.course_relationships.forEach((relation, index) => {
                edges.add(createEdge(data.course_name, course, {
                  label: relation,
                  color: '#4A90E2',
                  smooth: { type: 'continuous', roundness: 0.6 + (index * 0.3) }, // å¢åŠ å¼§åº¦
                  length: 250 + (index * 30) // å¢åŠ è¾¹é•¿åº¦é¿å…é‡å 
                }));
              });
            }
          }

          // æ·»åŠ æ•™å¸ˆ
          if (data.teachers) {
            data.teachers.forEach((teacher, i) => {
              nodes.add(createNode(teacher, {
                shape: 'ellipse',
                color: '#FFA07A',
                font: { size: 14 }
              }));

              const relation = data.teacher_relationships?.[i] || 'æ•™æˆ';
              edges.add(createEdge(teacher, data.course_name, {
                label: relation,
                color: '#FF6347'
              }));
            });
          }

          renderGraph(nodes, edges);
        }

        // ç»˜åˆ¶æ•™å¸ˆå…³ç³»å›¾
        function drawTeacherGraph(data) {
          const nodes = new vis.DataSet();
          const edges = new vis.DataSet();

          // æ·»åŠ æ•™å¸ˆèŠ‚ç‚¹
          nodes.add(createNode(data.teacher.name, {
            shape: 'ellipse',
            color: '#FFA07A',
            size: 25,
            font: { size: 16, bold: true }
          }));

          // æ·»åŠ æ•™æˆè¯¾ç¨‹
          if (data.courses) {
            data.courses.forEach((courseObj, i) => {
              nodes.add(createNode(courseObj.course, {
                shape: 'box',
                color: '#4A90E2',
                font: { size: 14 }
              }));

              edges.add(createEdge(data.teacher.name, courseObj.course, {
                label: courseObj.relation || 'æ•™æˆ',
                color: '#FF6347',
                smooth: { type: 'continuous', roundness: 0.3 + i * 0.1 }
              }));
            });
          }

          // æ·»åŠ æ‰€å±å­¦é™¢
          if (data.school?.name) {
            nodes.add(createNode(data.school.name, {
              shape: 'database',
              color: '#7EC699'
            }));

            edges.add(createEdge(data.teacher.name, data.school.name, {
              label: data.school.relation || 'éš¶å±äº',
              color: '#5FB27C',
              smooth: { type: 'continuous', roundness: 0.5 }
            }));
          }

          renderGraph(nodes, edges);
        }

        // åˆ›å»ºèŠ‚ç‚¹è¾…åŠ©å‡½æ•°
        function createNode(id, options = {}) {
          return {
            id,
            label: id,
            font: { size: 14, color: '#ffffff' },
            margin: 10,
            borderWidth: 2,
            shadow: true,
            ...options
          };
        }

        // åˆ›å»ºè¾¹è¾…åŠ©å‡½æ•°
        function createEdge(from, to, options = {}) {
          return {
            from,
            to,
            arrows: 'to',
            width: 2,
            font: { size: 12, align: 'middle', background: 'white' },
            smooth: { type: 'continuous', roundness: 0.3 },
            color: '#B0C4DE', // è®¾ç½®è¾¹çš„é¢œè‰²ä¸ºæµ…è“è‰²
            ...options
          };
        }

        // æ¸²æŸ“å›¾å½¢
        function renderGraph(nodes, edges) {
          const container = document.getElementById('graph');
          container.innerHTML = '';

          const graphData = { nodes, edges };
          const options = {
            nodes: {
              borderWidth: 2,
              shadow: true,
              margin: 10
            },
            edges: {
              width: 2,
              font: {
                size: 12,
                strokeWidth: 0,
                align: 'middle',
                background: 'white'
              },
              smooth: {
                type: 'continuous'
              },
              arrows: {
                to: {
                  scaleFactor: 0.5
                }
              }
            },
            physics: {
              enabled: true,
              solver: 'forceAtlas2Based',
              forceAtlas2Based: {
                gravitationalConstant: -50,
                centralGravity: 0.01,
                springLength: 200,
                springConstant: 0.08,
                damping: 0.4,
                avoidOverlap: 1
              }
            },
            interaction: {
              hover: true,
              tooltipDelay: 200
            }
          };

          new vis.Network(container, graphData, options);
        }
      });

      function searchCourse() {
        const targetElement = document.getElementById('heng2');

        // ç¡®ä¿ç›®æ ‡å…ƒç´ å­˜åœ¨
        if (targetElement) {
          const targetPosition = targetElement.offsetTop;

          console.log('ç›®æ ‡å…ƒç´ çš„ä½ç½®:', targetPosition); // è°ƒè¯•ä¿¡æ¯

          window.scrollTo({
            top: targetPosition,  // æ»šåŠ¨åˆ°ç›®æ ‡å…ƒç´ çš„ä½ç½®
            behavior: 'smooth'    // å¹³æ»‘æ»šåŠ¨
          });
        } else {
          console.log('ç›®æ ‡å…ƒç´  #heng2 æœªæ‰¾åˆ°');
        }
      }

    </script>
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        console.log('DOMContentLoaded event fired');  // ç¡®è®¤ DOM åŠ è½½å®Œæˆ

        // ç¡®ä¿æŒ‰é’®å’Œç›®æ ‡å…ƒç´ å­˜åœ¨
        const searchButton1 = document.getElementById("button1");
        const searchButton2 = document.getElementById("button2");
        const targetElement = document.getElementById("heng2"); // æ”¹ä¸º id="heng2"

        // è°ƒè¯•ä¿¡æ¯
        console.log('searchButton1:', searchButton1);
        console.log('searchButton2:', searchButton2);
        console.log('targetElement:', targetElement);

        // ç¡®ä¿æŒ‰é’®å’Œç›®æ ‡å…ƒç´ éƒ½å­˜åœ¨ï¼Œç»‘å®šäº‹ä»¶
        if ((searchButton1 && targetElement) || (searchButton2 && targetElement)) {
          console.log('Button and target element found, adding event listener.');

          // ç›‘å¬æŒ‰é’®ç‚¹å‡»äº‹ä»¶
          if (searchButton1) {
            searchButton1.addEventListener("click", function() {
              console.log('Button1 clicked, scrolling to target element.');
              targetElement.scrollIntoView({
                behavior: "smooth",  // å¹³æ»‘æ»šåŠ¨
                block: "start"       // æ»šåŠ¨åˆ°å…ƒç´ é¡¶éƒ¨
              });
            });
          }

          if (searchButton2) {
            searchButton2.addEventListener("click", function() {
              console.log('Button2 clicked, scrolling to target element.');
              targetElement.scrollIntoView({
                behavior: "smooth",  // å¹³æ»‘æ»šåŠ¨
                block: "start"       // æ»šåŠ¨åˆ°å…ƒç´ é¡¶éƒ¨
              });
            });
          }
        } else {
          console.log('Button or target element not found!');
        }
      });
    </script>




  </div>
<!-- now !-->
  <div id="analyze" class="page" style="
    max-width: 1600px;
    margin: 20px auto;
    background: white;
    border-radius: 12px;
    box-shadow: 0 6px 18px rgba(0, 0, 0, 0.08),
                0 0 0 1px rgba(0, 0, 0, 0.04),
                inset 0 0 0 1px rgba(255, 255, 255, 0.8);
    padding: 30px;
    position: relative;
    border: 1px solid #e0e0e0;
    border-top: 1px solid #f0f0f0;
    border-bottom: 1px solid #d0d0d0;
    background-color: #fafafa;
">
    <!-- æ ‡é¢˜åŒºåŸŸ -->
    <h2 style="color: #5c6bc0; margin-bottom: 20px; font-weight: 600; font-size: 28px; text-align: center;">
      å›¾æ•°æ®åˆ†æ
    </h2>
    <div style="height: 3px; width: 60px; background: linear-gradient(to right, #5c6bc0, #8e99f3); margin: 0 auto; border-radius: 3px;"></div>

    <p style="color: #555; font-size: 16px; text-align: center; margin-top: 20px;">é€‰æ‹©æ‚¨è¦å±•ç¤ºçš„æ•°æ®ç±»å‹ï¼Œå¹¶ç‚¹å‡»æŒ‰é’®è·å–æ•°æ®ï¼š</p>

    <!-- æ•°æ®ç±»å‹é€‰æ‹© -->
    <div style="display: flex; justify-content: center; gap: 10px; margin-top: 20px;">
      <select id="typeSelect" style="padding: 10px; font-size: 16px; border-radius: 5px; border: 1px solid #ddd; width: 200px;">
        <option value="school">å­¦æ ¡</option>
        <option value="class">è¯¾ç¨‹</option>
        <option value="teacher">æ•™å¸ˆ</option>
      </select>
      <button onclick="fetchData()" style="padding: 10px 20px; font-size: 16px; background-color: #8E99F3FF; color: white; cursor: pointer; border-radius: 5px; border: 1px solid #ddd;">
        è·å–æ•°æ®
      </button>
    </div>

    <!-- æ˜¾ç¤ºåŠ è½½æç¤º -->
    <div id="loading" class="loading" style="display:none; font-size: 18px; color: #8E99F3FF; text-align: center; margin-top: 20px;">
      æ­£åœ¨åŠ è½½...
    </div>

    <!-- æ˜¾ç¤ºæ•°æ®è¡¨æ ¼ -->
    <table id="dataTable" style="width: 100%; margin-top: 30px; border-collapse: separate; border-spacing: 0; display: none; border: 1px solid #ddd; border-radius: 10px; overflow: hidden;">
      <thead>
      <tr style="background-color: #8E99F3FF; color: white;">
        <th style="padding: 12px; text-align: left;">èŠ‚ç‚¹åç§°</th>
        <th style="padding: 12px; text-align: left;">ç±»åˆ«</th>
        <th style="padding: 12px; text-align: left;">å¾—åˆ†</th>
      </tr>
      </thead>
      <tbody id="tableBody"></tbody>
    </table>
  </div>


  <script>
    // è·å–æ•°æ®å¹¶æ¸²æŸ“è¡¨æ ¼
    function fetchData() {
      const type = document.getElementById('typeSelect').value; // è·å–é€‰æ‹©çš„ç±»å‹
      const url = `http://127.0.0.1:5000/api/searchCourse?type_name=${type}`; // æ‹¼æ¥æ¥å£URL

      // æ˜¾ç¤ºåŠ è½½ä¸­
      document.getElementById('loading').style.display = 'block';
      document.getElementById('dataTable').style.display = 'none';

      // è¯·æ±‚æ•°æ®
      fetch(url)
              .then(response => response.json())
              .then(data => {
                // éšè—åŠ è½½æç¤ºï¼Œæ˜¾ç¤ºè¡¨æ ¼
                document.getElementById('loading').style.display = 'none';
                document.getElementById('dataTable').style.display = 'table';

                // æ¸²æŸ“è¡¨æ ¼
                const tableBody = document.getElementById('tableBody');
                tableBody.innerHTML = ''; // æ¸…ç©ºè¡¨æ ¼å†…å®¹
                data.forEach(item => {
                  const row = document.createElement('tr');
                  row.style.backgroundColor = '#f9f9f9'; // è®¾ç½®è¡ŒèƒŒæ™¯è‰²
                  row.innerHTML = `
                            <td style="padding: 12px; text-align: left;">${item.NodeName}</td>
                            <td style="padding: 12px; text-align: left;">${item.category}</td>
                            <td style="padding: 12px; text-align: left;">${item.score}</td>
                        `;
                  tableBody.appendChild(row);
                });
              })
              .catch(error => {
                console.error('è·å–æ•°æ®æ—¶å‡ºé”™:', error);
                alert('è·å–æ•°æ®å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•ï¼');
              });
    }
  </script>


</div>

<script>
  // å›¾è¡¨å®ä¾‹å­˜å‚¨
  const charts = {
    chart1: null,
    chart2: null,
    chart3: null,
    chart4: null,
    chart5: null,
    chart6: null
  };

  // é¡µé¢åˆ‡æ¢åŠŸèƒ½
  const navItems = document.querySelectorAll('.nav-item');
  const pages = document.querySelectorAll('.page');

  function switchPage(pageId) {
    // æ›´æ–°å¯¼èˆªçŠ¶æ€
    navItems.forEach(i => i.classList.remove('active'));
    document.querySelector(`.nav-item[data-page="${pageId}"]`).classList.add('active');

    // æ›´æ–°é¡µé¢æ˜¾ç¤º
    pages.forEach(page => page.classList.toggle('active', page.id === pageId));

    // ä¿å­˜å½“å‰é¡µé¢
    localStorage.setItem('activePage', pageId);

    // å¦‚æœæ˜¯å›¾è¡¨é¡µé¢ï¼Œé‡æ–°è°ƒæ•´å›¾è¡¨å¤§å°
    if (pageId === 'chart') {
      setTimeout(() => {
        Object.values(charts).forEach(chart => {
          if (chart) chart.resize();
        });
      }, 300);
    }
  }

  // åˆå§‹åŒ–é¡µé¢åˆ‡æ¢
  navItems.forEach(item => {
    item.addEventListener('click', () => switchPage(item.getAttribute('data-page')));
  });

  // é¡µé¢åŠ è½½æ—¶æ¢å¤ä¸Šæ¬¡è®¿é—®çš„é¡µé¢
  document.addEventListener('DOMContentLoaded', () => {
    const activePage = localStorage.getItem('activePage') || 'home';
    switchPage(activePage);

    // åˆå§‹åŒ–æ‰€æœ‰å›¾è¡¨
    initCharts();

    // è®¾ç½®çª—å£å¤§å°å˜åŒ–ç›‘å¬
    window.addEventListener('resize', () => {
      if (document.querySelector('#chart.page.active')) {
        Object.values(charts).forEach(chart => {
          if (chart) chart.resize();
        });
      }
    });
  });

  // åˆå§‹åŒ–æ‰€æœ‰å›¾è¡¨
  function initCharts() {
    initChart1();
    initChart2();
    initChart3();
    initChart4();
    initChart5();
    initChart6();
  }

  function initChart1() {
    fetch('http://localhost:5000/api/chart1')
            .then(response => response.json())
            .then(data => {
              if (data.success) {
                // å°†æ•°æ®è½¬æ¢ä¸ºæ•°ç»„å¹¶æ’åº
                const sortedData = Object.entries(data.data)
                        .sort((a, b) => b[1] - a[1]); // æŒ‰å€¼é™åºæ’åº

                // åˆ†ç¦»æ’åºåçš„è¯¾ç¨‹å’Œå€¼
                const courses = sortedData.map(item => item[0]);
                const values = sortedData.map(item => item[1]);

                charts.chart1 = echarts.init(document.getElementById('chart1'));

                const option = {
                  backgroundColor: '#ffffff',
                  grid: {
                    top: '10%',
                    left: '3%',
                    right: '4%',
                    bottom: '15%', // åº•éƒ¨ç•™æ›´å¤šç©ºé—´ç»™ç¼©æ”¾æ¡
                    containLabel: true
                  },
                  tooltip: {
                    trigger: 'axis',
                    axisPointer: {
                      type: 'shadow'
                    },
                    formatter: '{b}: {c}'
                  },
                  xAxis: {
                    type: 'category',
                    data: courses,
                    axisLabel: {
                      rotate: 45,
                      interval: 0, // å¼ºåˆ¶æ˜¾ç¤ºæ‰€æœ‰æ ‡ç­¾
                      fontSize: 10,
                      formatter: function(value) {
                        // è¿‡é•¿æ ‡ç­¾æ¢è¡Œå¤„ç†
                        if (value.length > 10) {
                          return value.substring(0, 10) + '\n' + value.substring(10);
                        }
                        return value;
                      }
                    }
                  },
                  yAxis: {
                    type: 'value',
                    name: 'æŠ¥åäººæ•°',
                    nameLocation: 'middle',
                    nameGap: 30
                  },
                  series: [{
                    name: 'è¯¾ç¨‹æ•°é‡',
                    type: 'bar',
                    data: values,
                    itemStyle: {
                      color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                        { offset: 0, color: '#a1c4fd' }, // é¡¶éƒ¨æµ…è‰²
                        { offset: 0.5, color: '#5A9EC9' }, // ä¸­é—´ä¸»è‰²
                        { offset: 1, color: '#3a7bb7' } // åº•éƒ¨æ·±è‰²
                      ]),
                      borderRadius: [4, 4, 0, 0] // é¡¶éƒ¨åœ†è§’
                    },
                    label: {
                      show: true,
                      position: 'top',
                      formatter: '{c}',
                      color: '#333'
                    },
                    barWidth: '60%',
                    emphasis: { // é€‰ä¸­é«˜äº®æ•ˆæœ
                      itemStyle: {
                        color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                          { offset: 0, color: '#ff9a9e' }, // é¡¶éƒ¨æµ…çº¢è‰²
                          { offset: 0.5, color: '#fad0c4' }, // ä¸­é—´è¿‡æ¸¡è‰²
                          { offset: 1, color: '#ff6b8b' } // åº•éƒ¨æ·±çº¢è‰²
                        ]),
                        shadowColor: 'rgba(255, 107, 139, 0.5)',
                        shadowBlur: 10,
                        shadowOffsetY: 3
                      },
                      label: {
                        fontWeight: 'bold',
                        color: '#d32f2f'
                      }
                    }
                  }],
                  dataZoom: [{
                    type: 'slider',
                    show: true,
                    xAxisIndex: [0],
                    bottom: '5%',
                    height: 20,
                    handleSize: '80%',
                    start: 0,
                    end: 50,
                    fillerColor: 'rgba(90, 158, 201, 0.2)',
                    borderColor: '#5A9EC9',
                    handleStyle: {
                      color: '#5A9EC9',
                      borderColor: '#5A9EC9'
                    },
                    textStyle: {
                      color: '#5A9EC9'
                    }
                  }]
                };

                charts.chart1.setOption(option);
                setTimeout(() => charts.chart1.resize(), 100);
              }
            })
            .catch(error => {
              console.error('åŠ è½½å›¾è¡¨æ•°æ®å¤±è´¥:', error);
              // å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ é”™è¯¯å¤„ç†ï¼Œæ¯”å¦‚æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
            });
  }

  function initChart2() {
    fetch('http://localhost:5000/api/chart2')
            .then(response => response.json())
            .then(data => {
              if (data.success) {
                // å°†æ•°æ®è½¬æ¢ä¸ºæ•°ç»„å¹¶æ’åº
                const sortedData = Object.entries(data.data)
                        .sort((a, b) => b[1] - a[1]); // æŒ‰å€¼é™åºæ’åº

                // åˆ†ç¦»æ’åºåçš„çŸ¥è¯†ç‚¹å’Œå€¼
                const knowledgePoints = sortedData.map(item => item[0]);
                const values = sortedData.map(item => item[1]);

                charts.chart2 = echarts.init(document.getElementById('chart2'));

                const option = {
                  backgroundColor: '#ffffff',
                  grid: {
                    top: '10%',
                    left: '3%',
                    right: '4%',
                    bottom: '15%', // åº•éƒ¨ç•™æ›´å¤šç©ºé—´ç»™é•¿æ ‡ç­¾
                    containLabel: true
                  },
                  tooltip: {
                    trigger: 'axis',
                    axisPointer: {
                      type: 'shadow'
                    },
                    formatter: '{b}: {c}'
                  },
                  xAxis: {
                    type: 'category',
                    data: knowledgePoints,
                    axisLabel: {
                      rotate: 60, // æ›´å¤§çš„æ—‹è½¬è§’åº¦
                      interval: 0, // å¼ºåˆ¶æ˜¾ç¤ºæ‰€æœ‰æ ‡ç­¾
                      fontSize: 10, // æ›´å°çš„å­—ä½“
                      formatter: function(value) {
                        // è¿‡é•¿æ ‡ç­¾æ¢è¡Œå¤„ç†
                        if (value.length > 10) {
                          return value.substring(0, 10) + '\n' + value.substring(10);
                        }
                        return value;
                      }
                    }
                  },
                  yAxis: {
                    type: 'value',
                    name: 'çŸ¥è¯†ç‚¹æ•°é‡',
                    nameLocation: 'middle',
                    nameGap: 30
                  },
                  series: [{
                    name: 'çŸ¥è¯†ç‚¹æ•°é‡',
                    type: 'bar',
                    data: values,
                    itemStyle: {
                      color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                        { offset: 0, color: '#83bff6' },
                        { offset: 0.5, color: '#188df0' },
                        { offset: 1, color: '#0077e6' }
                      ]),
                      borderRadius: [0, 0, 4, 4] // åº•éƒ¨åœ†è§’ï¼Œä¸ç¬¬ä¸€ä¸ªå›¾è¡¨ç›¸å
                    },
                    label: {
                      show: true,
                      position: 'top',
                      formatter: '{c}',
                      color: '#333'
                    },
                    barWidth: '40%', // æ›´çª„çš„æŸ±æ¡
                    emphasis: {
                      itemStyle: {
                        color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                          { offset: 0, color: '#ff9a8b' },
                          { offset: 0.5, color: '#ff6b8b' },
                          { offset: 1, color: '#ff4d6d' }
                        ])
                      }
                    }
                  }],
                  dataZoom: [ // æ·»åŠ æ•°æ®ç¼©æ”¾åŠŸèƒ½
                    {
                      type: 'slider',
                      show: true,
                      xAxisIndex: [0],
                      bottom: '5%',
                      height: 20,
                      handleSize: '100%',
                      start: 0,
                      end: 50 // åˆå§‹æ˜¾ç¤º50%çš„æ•°æ®
                    }
                  ]
                };

                charts.chart2.setOption(option);
                setTimeout(() => charts.chart2.resize(), 100);
              }
            })
            .catch(error => {
              console.error('åŠ è½½çŸ¥è¯†ç‚¹æ•°æ®å¤±è´¥:', error);
              // å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ é”™è¯¯å¤„ç†ï¼Œæ¯”å¦‚æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
            });
  }

  function initChart3() {
    // ç¡®ä¿å®¹å™¨å­˜åœ¨ä¸”æœ‰å°ºå¯¸
    const container = document.getElementById('chart3');
    if (!container) {
      console.error('æ‰¾ä¸åˆ°chart3å®¹å™¨');
      return;
    }

    container.innerHTML = ''; // æ¸…ç©ºå®¹å™¨
    container.style.width = '100%';
    container.style.height = '100vh';  // è®¾ç½®å®¹å™¨é«˜åº¦ä¸ºè§†å£é«˜åº¦ï¼Œç¡®ä¿é¥¼å›¾å°½é‡å¤§

    // é”€æ¯æ—§å®ä¾‹
    if (charts.chart3) {
      charts.chart3.dispose();
    }

    // ä» API è·å–æ•°æ®
    fetch('http://localhost:5000/api/chart3')
            .then(response => response.json())
            .then(data => {
              // æ£€æŸ¥æ•°æ®æ ¼å¼
              if (!data || !data.data || typeof data.data !== 'object') {
                throw new Error('APIè¿”å›çš„æ•°æ®æ ¼å¼ä¸æ­£ç¡®');
              }

              // è½¬æ¢æ•°æ®æ ¼å¼ä¸ºé¥¼å›¾æ‰€éœ€çš„æ ¼å¼
              const pieData = Object.entries(data.data).map(([name, value]) => ({
                name: name,
                value: value
              }));

              console.log('é¥¼å›¾æ•°æ®:', pieData); // æ£€æŸ¥è½¬æ¢åçš„æ•°æ®

              // åˆå§‹åŒ–å›¾è¡¨
              charts.chart3 = echarts.init(container);

              const option = {
                title: {
                  show: false, // ä¸æ˜¾ç¤ºæ ‡é¢˜
                },
                tooltip: {
                  trigger: 'item',
                  formatter: '{b}: {c} ({d}%)'
                },
                series: [{
                  type: 'pie',
                  radius: '50%',  // é¥¼å›¾åŠå¾„
                  data: pieData,  // é¥¼å›¾æ•°æ®
                  label: {
                    show: true,
                    position: 'outside',
                    formatter: '{b}: {c} ({d}%)'  // æ˜¾ç¤ºç™¾åˆ†æ¯”
                  },
                  emphasis: {
                    itemStyle: {
                      shadowBlur: 10,
                      shadowOffsetX: 0,
                      shadowColor: 'rgba(0, 0, 0, 0.5)'
                    }
                  }
                }]
              };

              // è®¾ç½®å›¾è¡¨é€‰é¡¹
              charts.chart3.setOption(option);

              // åˆå§‹è°ƒæ•´å¤§å°
              setTimeout(() => {
                charts.chart3.resize();
              }, 100);
            })
            .catch(error => {
              console.error('åŠ è½½é¥¼å›¾æ•°æ®å¤±è´¥:', error);
            });
  }

  function initChart4() {
    // ç¡®ä¿å®¹å™¨å­˜åœ¨ä¸”æœ‰å°ºå¯¸
    const container = document.getElementById('chart4');
    if (!container) {
      console.error('æ‰¾ä¸åˆ°chart4å®¹å™¨');
      return;
    }

    container.innerHTML = ''; // æ¸…ç©ºå®¹å™¨
    container.style.width = '100%';
    container.style.height = '100vh';  // è®¾ç½®å®¹å™¨é«˜åº¦ä¸ºè§†å£é«˜åº¦ï¼Œç¡®ä¿è¯äº‘å›¾å°½é‡å¤§

    // é”€æ¯æ—§å®ä¾‹
    if (charts.chart4) {
      charts.chart4.dispose();
    }

    // ä» API è·å–æ•°æ®
    fetch('http://localhost:5000/api/chart4')
            .then(response => response.json())
            .then(data => {
              // æ£€æŸ¥æ•°æ®æ ¼å¼
              if (!data || typeof data !== 'object') {
                throw new Error('APIè¿”å›çš„æ•°æ®æ ¼å¼ä¸æ­£ç¡®');
              }

              // è½¬æ¢æ•°æ®æ ¼å¼
              const wordData = Object.entries(data).map(([name, value]) => ({
                name: name,
                value: value,
                textStyle: {
                  fontSize: 15 + value * 4,  // æ ¹æ®è¯é¢‘è®¾ç½®å­—ä½“å¤§å°
                  color: getRandomColor()   // éšæœºé¢œè‰²
                }
              }));

              console.log('è¯äº‘æ•°æ®:', wordData); // æ£€æŸ¥è½¬æ¢åçš„æ•°æ®

              // åˆå§‹åŒ–å›¾è¡¨
              charts.chart4 = echarts.init(container);

              const option = {
                title: {
                  show: false, // ä¸æ˜¾ç¤ºæ ‡é¢˜
                },
                tooltip: {
                  show: true,
                  formatter: params => `${params.name}: ${params.value}`
                },
                series: [{
                  type: 'wordCloud',
                  shape: 'circle',
                  left: 'center',
                  top: 'center',
                  width: '90%',
                  height: '90%',
                  sizeRange: [15, 60],  // è®¾ç½®å­—ä½“å¤§å°èŒƒå›´ï¼Œç¡®ä¿æœ‰æ˜æ˜¾çš„å¤§å°å·®å¼‚
                  rotationRange: [-30, 30],  // é™åˆ¶è¯è¯­æ—‹è½¬èŒƒå›´
                  rotationStep: 15,
                  gridSize: 10,  // å¢åŠ ç½‘æ ¼å¤§å°ï¼Œå¢åŠ è¯æ±‡é—´è·
                  drawOutOfBound: false,
                  textStyle: {
                    fontFamily: 'Microsoft YaHei',
                    fontWeight: 'bold',
                  },
                  emphasis: {
                    focus: 'self',
                    textStyle: {
                      textShadowBlur: 10,
                      textShadowColor: '#333'
                    }
                  },
                  data: wordData
                }]
              };

              // è®¾ç½®å›¾è¡¨é€‰é¡¹
              charts.chart4.setOption(option);

              // æ·»åŠ äº‹ä»¶ç›‘å¬
              charts.chart4.on('finished', function() {
                console.log('è¯äº‘å›¾æ¸²æŸ“å®Œæˆ');
              });

              charts.chart4.on('error', function(err) {
                console.error('è¯äº‘å›¾æ¸²æŸ“é”™è¯¯:', err);
              });

              // åˆå§‹è°ƒæ•´å¤§å°
              setTimeout(() => {
                charts.chart4.resize();
                console.log('è¯äº‘å›¾å·²è°ƒæ•´å¤§å°');
              }, 100);
            })
            .catch(error => {
              console.error('åŠ è½½è¯äº‘æ•°æ®å¤±è´¥:', error);
            });

    // éšæœºé¢œè‰²å‡½æ•°
    function getRandomColor() {
      return 'rgb(' + [
        Math.round(Math.random() * 160 + 80),
        Math.round(Math.random() * 160 + 80),
        Math.round(Math.random() * 160 + 80)
      ].join(',') + ')';
    }
  }

  function initChart5() {
    // ç¡®ä¿å®¹å™¨å­˜åœ¨ä¸”æœ‰å°ºå¯¸
    const container = document.getElementById('chart5');
    if (!container) {
      console.error('æ‰¾ä¸åˆ°chart5å®¹å™¨');
      return;
    }

    container.innerHTML = ''; // æ¸…ç©ºå®¹å™¨
    container.style.width = '100%';
    container.style.height = '100vh';  // è®¾ç½®å®¹å™¨é«˜åº¦ä¸ºè§†å£é«˜åº¦ï¼Œç¡®ä¿æŠ˜çº¿å›¾å°½é‡å¤§

    // é”€æ¯æ—§å®ä¾‹
    if (charts.chart5) {
      charts.chart5.dispose();
    }

    // è°ƒç”¨æ¥å£è·å–æ•°æ®
    fetch('http://localhost:5000/api/chart5')
            .then(response => response.json())
            .then(data => {
              if (data.success) {
                const schoolNames = Object.keys(data.data);
                const schoolValues = Object.values(data.data);

                // åˆå§‹åŒ–æŠ˜çº¿å›¾
                charts.chart5 = echarts.init(container);

                const option = {
                  title: {
                    show: false,  // ä¸æ˜¾ç¤ºæ ‡é¢˜
                  },
                  tooltip: {
                    trigger: 'axis',
                    formatter: '{b}: {c}',
                  },
                  xAxis: {
                    type: 'category',
                    data: schoolNames,  // Xè½´ä¸ºå­¦æ ¡åç§°
                  },
                  yAxis: {
                    type: 'value',
                    name: 'æ•°å€¼',
                  },
                  series: [{
                    data: schoolValues,  // Yè½´ä¸ºå­¦æ ¡å¯¹åº”çš„æ•°å€¼
                    type: 'line',
                    smooth: true,
                    label: {
                      show: true,
                      position: 'top',
                    },
                    lineStyle: {
                      color: '#1e90ff',
                    },
                    itemStyle: {
                      color: '#1e90ff',
                    }
                  }]
                };

                charts.chart5.setOption(option);
                setTimeout(() => charts.chart5.resize(), 100);
              } else {
                console.error('æ•°æ®åŠ è½½å¤±è´¥');
              }
            })
            .catch(error => {
              console.error('åŠ è½½æ•°æ®å¤±è´¥:', error);
            });
  }

  function initChart6() {
    // ç¡®ä¿å®¹å™¨å­˜åœ¨ä¸”æœ‰å°ºå¯¸
    const container = document.getElementById('chart6');
    if (!container) {
      console.error('æ‰¾ä¸åˆ°chart6å®¹å™¨');
      return;
    }

    container.innerHTML = ''; // æ¸…ç©ºå®¹å™¨
    container.style.width = '100%';
    container.style.height = '100vh';  // è®¾ç½®å®¹å™¨é«˜åº¦ä¸ºè§†å£é«˜åº¦ï¼Œç¡®ä¿é¥¼å›¾å°½é‡å¤§

    // é”€æ¯æ—§å®ä¾‹
    if (charts.chart6) {
      charts.chart6.dispose();
    }

    // è°ƒç”¨æ¥å£è·å–æ•°æ®
    fetch('http://localhost:5000/api/chart5')
            .then(response => response.json())
            .then(data => {
              if (data.success) {
                const schoolNames = Object.keys(data.data);
                const schoolValues = Object.values(data.data);

                // åˆå§‹åŒ–é¥¼å›¾
                charts.chart6 = echarts.init(container);

                const option = {
                  title: {
                    show: false,  // ä¸æ˜¾ç¤ºæ ‡é¢˜
                  },
                  tooltip: {
                    trigger: 'item',
                    formatter: '{b}: {c} ({d}%)'  // æ˜¾ç¤ºç™¾åˆ†æ¯”
                  },
                  series: [{
                    type: 'pie',  // è®¾ç½®ä¸ºé¥¼å›¾
                    radius: '50%',  // é¥¼å›¾åŠå¾„
                    data: schoolNames.map((name, index) => ({
                      name: name,
                      value: schoolValues[index],
                    })),
                    label: {
                      show: true,
                      position: 'outside',
                      formatter: '{b}: {c} ({d}%)'  // æ˜¾ç¤ºæ•°æ®æ ‡ç­¾
                    },
                    emphasis: {
                      itemStyle: {
                        shadowBlur: 10,
                        shadowOffsetX: 0,
                        shadowColor: 'rgba(0, 0, 0, 0.5)'
                      }
                    }
                  }]
                };

                charts.chart6.setOption(option);
                setTimeout(() => charts.chart6.resize(), 100);
              } else {
                console.error('æ•°æ®åŠ è½½å¤±è´¥');
              }
            })
            .catch(error => {
              console.error('åŠ è½½æ•°æ®å¤±è´¥:', error);
            });
  }
</script>
</body>
</html>